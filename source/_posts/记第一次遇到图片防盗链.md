---
title: 由图片盗链所引发的。。。
date: 2017-10-13 23:54:05
tags: http node
---

豆瓣电影这个app我用了很久，但是最近突然改版了，个人觉得ui没有原来好看，刚好豆瓣实验室提供了必须的api，所以打算自己写个项目展示一些电影数据。

-----------

豆瓣实验室提供的api很不错，相当一部分的数据都能找到了，但是开发的第一天就遇到了问题————图片盗链。

api返回数据中包含了电影的海报url，当我把img元素的src指向url时，服务器却返回了403。

![请求图片403错误](https://raw.githubusercontent.com/Renascence/Renascence.github.io/hexo/source/_posts/img/douban403.png)

说实话，403这个报错之前开发我一直没遇到过，正好学习一下。

### http 请求头中的 referer

> HTTP参照位址（referer，或HTTP referer）是HTTP表头的一个栏位，用来表示从哪儿连结到目前的网页，採用的格式是URL。换句话说，藉着HTTP参照位址，目前的网页可以检查访客从哪裡而来，这也常被用来对付伪造的跨网站请求。

然后对照我发起请求的时候带的referer

![referer](https://raw.githubusercontent.com/Renascence/Renascence.github.io/hexo/source/_posts/img/referer.png)

我用webpack开发，端口设置的是7000，所以referer信息显示的是

```
Referer:http://localhost:7000/
```

找到问题所在了，看上去只要把请求中的referer改掉就行了。然而经过我多次的查阅资料，发现是无法从前端修改referer的，只能换个思路：

1. 搭建node服务器，请求前端请求发给node，由node转发伪造referer。

2. 根据api返回的图片url下载到本地访问。

因为目前只打算在ghpages上写一个静态页面，所以选择了第二种解决方案，写了一个[脚本](https://github.com/Renascence/movieData/blob/master/src/utils/getImages.js)

并把这个脚本加到package.json中去

```
"start": "node src/utils/getImages.js && webpack-dev-server --content-base --inline --hot --open",
```

这样每次开发启动服务都会更新一下本地下载的图片。
